# generator_bot

Telegram-бот для ведення роботи генератора: відкриття/закриття змін, прийом палива, графік відключень і адмін-функції з інтеграцією з Google Sheets.

## Можливості
- Зміни: **Зміна 1 → Зміна 2 → Зміна 3** (по черзі) + "Екстра"; старт/стоп з синхронізацією з таблицею.
- Графік відключень: перегляд/редагування (для адміна) + розсилка повідомлень про зміни.
- Прийом палива: фіксація прийому (водій, літри, чек) через інтерактивний сценарій.
- Адмінка: завантаження Excel-звіту (експорт “як в оригінальній таблиці”), персонал (колонка AC), список користувачів, водії, ТО.

## Залежності
Встановлення залежностей:

```bash
pip install -r requirements.txt
```

`requirements.txt` містить: aiogram, gspread, google-auth (+ oauthlib/httplib2), python-dotenv, pytz, pandas, openpyxl.

## Налаштування
### 1) .env
Проєкт перевіряє наявність обовʼязкових змінних при старті.

Обов’язково:
- `BOT_TOKEN` — токен Telegram-бота.
- `SHEET_ID_PROD` — ID Google Spreadsheet для PROD.
- `SHEET_ID_TEST` — ID Google Spreadsheet для TEST.
- `ADMINS` — список Telegram ID адмінів через кому.

Опційно:
- `MODE` = `TEST` або `PROD` (за замовчуванням `TEST`).
- `SHEET_NAME` — назва вкладки (worksheet), за замовчуванням `ЛЮТИЙ`.
- `TIMEZONE` — за замовчуванням `Europe/Kyiv`.
- `WORK_START` / `WORK_END` — графік роботи (дефолт `07:30` / `20:30`).
- `BRIEF_TIME` — дефолт `07:30`.
- `OIL_LIMIT` — ліміт ТО, дефолт `100`.
- `BOT_STATUS` — `ON`/`OFF` (впливає на реєстрацію), дефолт `ON`.
- `USERS` — whitelist користувачів (ID через кому), якщо використовується.
- `FUEL_RATE` — витрата палива (л/год); якщо не задано або не число — буде 5.3.

### 2) service_account.json
Покладіть `service_account.json` у корінь проєкту — він використовується для читання/експорту Google Sheets.
Надайте доступ до Google Spreadsheet email-адресі service account (вона всередині JSON).

### 3) Вимоги до таблиці
- Бот знаходить рядок “сьогодні” у колонці A та працює з діапазоном `A:I` для змін.
- Список “ПЕРСОНАЛ” береться з колонки AC (використовується для прив’язки користувачів в адмінці).

## Запуск
1) Створіть venv (за бажанням), встановіть залежності.
2) Створіть `.env`, додайте `service_account.json`.
3) Запуск:

```bash
python main.py
```

## Команди
- `/start` — відкрити головне меню.

## Безпека
Не комітьте `.env` та `service_account.json` у репозиторій.
